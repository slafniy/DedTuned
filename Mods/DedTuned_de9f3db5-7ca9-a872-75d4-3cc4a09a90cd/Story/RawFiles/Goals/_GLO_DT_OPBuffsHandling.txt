Version 1
SubGoalCombiner SGC_AND
INITSECTION
//REGION Overpowered buffs which have to be removed if its caster left the party
DB_DT_OPBufffs_List("LONGSTRIDER");
DB_DT_OPBufffs_List("GUIDANCE");
//END_REGION
KBSECTION
//REGION OP Cast handler
// Store casted spells info to check if some OP spell is casted on teammate
// data to store: TARGET, STATUS, CASTER
// override it every new status application (buffs replace each other not stack)

// Status is re-applied and we have a record about this cast type remove information about old caster
IF
StatusApplied((CHARACTER)_Target,_Status,(CHARACTER)_Caster,_)
AND
DB_DT_OPBuffs_Casted((CHARACTER)_Target,(STRING)_Status,(CHARACTER)_OldCaster)
THEN
NOT DB_DT_OPBuffs_Casted((CHARACTER)_Target,(STRING)_Status,(CHARACTER)_OldCaster);

// If status applied within teammates and cast is in DB_DT_OPBufffs_List - store info about it
IF
StatusApplied((CHARACTER)_Target,_Status,(CHARACTER)_Caster,_)
AND
DB_PartOfTheTeam(_Caster)
AND
DB_PartOfTheTeam(_Target)
AND
DB_DT_OPBufffs_List(_Status)
THEN
DB_DT_OPBuffs_Casted((CHARACTER)_Target,(STRING)_Status,(CHARACTER)_Caster);
//END_REGION


// Caster in party, target leaves
IF
DB_DT_OPBuffs_Casted((CHARACTER)_Target,(STRING)_Status,(CHARACTER)_Caster)
AND
_Target != _Caster  // allow to keep buff on self
AND
DB_PartyMembers(_Caster)
AND
NOT DB_PartyMembers(_Target)
AND
HasAppliedStatus(_Target, _Status, 1)
AND
Concatenate("Removing ", _Status, _msg1)
THEN
RemoveStatus(_Target, _Status, DT_OPBuffRemoving_4af7efc8-ab80-4ac3-bbe6-ce448f36f5f6);
DebugText(_Target, _msg1);


// Target in party, caster leaves
IF
DB_DT_OPBuffs_Casted((CHARACTER)_Target,(STRING)_Status,(CHARACTER)_Caster)
AND
_Target != _Caster  // allow to keep buff on self
AND
NOT DB_PartyMembers(_Caster)
AND
DB_PartyMembers(_Target)
AND
HasAppliedStatus(_Target, _Status, 1)
AND
Concatenate("Removing ", _Status, _msg1)
THEN
RemoveStatus(_Target, _Status, DT_OPBuffRemoving_4af7efc8-ab80-4ac3-bbe6-ce448f36f5f6);
DebugText(_Target, _msg1);






EXITSECTION

ENDEXITSECTION
